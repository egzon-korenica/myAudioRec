{% extends "layout.html" %}
{% block content %}

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load("current", {packages: ["corechart"]});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Tone', 'Frequence'],
                {% for key, value in ta_data.items() %}
                    {% if value is string %}
                        ['{{ key }}', '{{ value }}'],
                    {% else %}
                        ['{{ key }}', {{ value }}],
                    {% endif %}
                {% endfor %}
            ]);

            var options = {
                title: 'General Tone Analysis made for this Survey',
                is3D: true,
                backgroundColor: '#e9ecef',
                titleTextStyle: {
                    fontSize: 20,
                    italic: true,
                    bold: false
                },
                legend: {position: 'bottom', textStyle: {fontSize: 20}}
            };

            var chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
            chart.draw(data, options);

            $("text:contains(" + options.title + ")").attr({'x': '300', 'y': '60'})
        }
    </script>
    <div class="container">
        <div class="row">
            <div class="col">
                <div class="jumbotron">
                    {% for k in survey %}
                        <h2 class="display-4">{{ k.Questions.topic }}</h2>
                        {% for question in k.Questions.questions %}
                            <p class="h5">{{ question }}</p>
                        {% endfor %}
                    {% endfor %}
                </div>
            </div>
            <div class="col">
                <div class="jumbotron">
                    {% for k in survey %}
                        <h2 class="display-4"><a class="article-title"
                                                 href="{{ url_for('responses', survey_id=k.Survey.id) }}">Responses</a>
                        </h2>
                        <p>Number of submitted responses: {{ nr_responses + nr_convLeft }}</p>
                        <p>Number of converted responses: {{ nr_responses }}</p>
                        <p>Number of conversions left: {{ nr_convLeft }}</p>
                        <form class="generateResponse mt-3" action="{{ url_for('survey', survey_id=k.Survey.id) }}"
                              method="post">
                              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <p>
                                <button type="submit" class="btn btn-default border border-primary">Convert Responses to
                                    Text
                                </button>
                            </p>
                        </form>
                    {% endfor %}
                </div>
            </div>
            <div class="w-100"></div>
            <div class="col">
                <div class="jumbotron">
                    {% for k in survey %}
                        <h2 class="display-4">Tone Analysis</h2>
                        <div id="piechart_3d" style="width: 1000px; height: 500px;"></div>
                    {% endfor %}
                </div>
            </div>
            <div class="col">
                <div class="jumbotron">
                    {% for k in survey %}
                        <h2 class="display-4"><a class="article-title"
                                                 href="{{ url_for('keywords', survey_id=k.Survey.id) }}">Keyword
                            Analysis</a></h2>
                        <p>Number of keywords for {{ nr_responses }} submitted responses: {{ k_data.keys()|length }}</p>
                        <p>Average relevance score of the keywords: {{ avg_rel }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
